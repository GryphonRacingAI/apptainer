Bootstrap: docker
From: osrf/ros:humble-desktop-full
%files 
    # Obtain files from 
    CarMakerOffice-linux-14.1.1 /CD 
%post
    
    apt-get -y update
    apt-get -y install vim tree
    # Below may alr be in humble-desktop-full but just in case
    apt-get -y install python3-pip
    apt-get -y install python3.10-venv
    
    
    # Carmaker Deps
    apt-get install -y libopengl0 libglx0 libegl1

    export DEBIAN_FRONTEND=noninteractive
    echo "ttf-mscorefonts-installer msttcorefonts/accepted-mscorefonts-eula select true" | debconf-set-selections
    apt-get install -y --reinstall ttf-mscorefonts-installer
    dpkg-reconfigure -f noninteractive ttf-mscorefonts-installer
  
    # Graphics Drivers 
    cat << EOF > /etc/vulkan/icd.d/nvidia_icd.json
{
    "file_format_version": "1.0.0",
    "ICD": {
        "library_path": "libGLX_nvidia.so.0",
        "api_version": "1.3"
    }
}
EOF

    cd CD
    chmod +x ipg-install
    ./ipg-install -batch -ipghome /opt/ipg || echo "Install warning: Check logs for license/package issues"

    # make sure Licenses is moved to CD
    mv Licenses /opt/ipg/etc
 
    cd /opt/ros
    ln -sfn humble ros2

    # ---- Custom packages ----
    # pdf viewer to read pdf carmaker docs
    apt install -y evince